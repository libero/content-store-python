version: '3'

services:
    venv:
        build:
            context: .
            dockerfile: Dockerfile.venv
            args:
                pipenv_dev_arg: ${PIPENV_DEV_ARG}
        image: libero/digests_venv:${IMAGE_TAG}
    cli:
        build:
            context: .
            dockerfile: Dockerfile
            args:
                image_tag: ${IMAGE_TAG}
        image: libero/digests:${IMAGE_TAG}
        environment:
            - FLASK_APP=api/api.py
        command: .venv/bin/flask run --host=0.0.0.0
        stop_signal: SIGINT
        ports:
            - 5000:5000
        depends_on:
            - venv

